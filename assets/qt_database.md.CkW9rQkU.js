import{_ as a,c as n,o as e,ag as p}from"./chunks/framework.DEfe5M7j.js";const h=JSON.parse('{"title":"Win 11 使用 QT 5.15.2 MySQL 插件","description":"","frontmatter":{},"headers":[],"relativePath":"qt/database.md","filePath":"qt/database.md","lastUpdated":1751208794000}'),l={name:"qt/database.md"};function i(t,s,r,c,d,o){return e(),n("div",null,s[0]||(s[0]=[p(`<h1 id="win-11-使用-qt-5-15-2-mysql-插件" tabindex="-1">Win 11 使用 QT 5.15.2 MySQL 插件 <a class="header-anchor" href="#win-11-使用-qt-5-15-2-mysql-插件" aria-label="Permalink to &quot;Win 11 使用 QT 5.15.2 MySQL 插件&quot;">​</a></h1><h2 id="编译" tabindex="-1">编译 <a class="header-anchor" href="#编译" aria-label="Permalink to &quot;编译&quot;">​</a></h2><p>安装时选择安装 QT 源码，定位 plugin 目录 <code>C:\\Qt\\5.15.2\\Src\\qtbase\\src\\plugins\\sqldrivers</code>，保守起见，可以对该目录进行备份。</p><p>QtCreator 打开 <code>C:\\Qt\\5.15.2\\Src\\qtbase\\src\\plugins\\sqldrivers\\mysql\\mysql.pro</code>，环境选择 Mingw81_64。</p><p>进行如下修改</p><div class="language-qmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">qmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>TARGET = qsqlmysql</span></span>
<span class="line"><span></span></span>
<span class="line"><span>HEADERS += $$PWD/qsql_mysql_p.h</span></span>
<span class="line"><span>SOURCES += $$PWD/qsql_mysql.cpp $$PWD/main.cpp</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 注释如下一行</span></span>
<span class="line"><span># QMAKE_USE += mysql</span></span>
<span class="line"><span></span></span>
<span class="line"><span>OTHER_FILES += mysql.json</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLUGIN_CLASS_NAME = QMYSQLDriverPlugin</span></span>
<span class="line"><span>include(../qsqldriverbase.pri)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 新增如下三行</span></span>
<span class="line"><span>INCLUDEPATH += &quot;C:/Program Files/MySQL/MySQL Server 9.1/include&quot;</span></span>
<span class="line"><span>DEPENDPATH += &quot;C:/Program Files/MySQL/MySQL Server 9.1/include&quot;</span></span>
<span class="line"><span>LIBS += &quot;C:/Program Files/MySQL/MySQL Server 9.1/lib/libmysql.lib&quot;</span></span></code></pre></div><p>其中 <code>C:/Program Files/MySQL/MySQL Server 9.1</code> 为你 MySQL Server 的安装目录。</p><p>同时对 <code>C:\\Qt\\5.15.2\\Src\\qtbase\\src\\plugins\\sqldrivers\\qsqldriverbase.pri</code> 进行修改</p><div class="language-qmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">qmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>QT  = core core-private sql-private</span></span>
<span class="line"><span></span></span>
<span class="line"><span># For QMAKE_USE in the parent projects.</span></span>
<span class="line"><span># 注释如下一行</span></span>
<span class="line"><span># include($$shadowed($$PWD)/qtsqldrivers-config.pri)</span></span>
<span class="line"><span># 新增如下一行</span></span>
<span class="line"><span>include(./configure.pri)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PLUGIN_TYPE = sqldrivers</span></span>
<span class="line"><span>load(qt_plugin)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>DEFINES += QT_NO_CAST_TO_ASCII QT_NO_CAST_FROM_ASCII</span></span></code></pre></div><p>在 QtCreator 选择 Release，然后 Build。</p><p>然后会在 <code>C:\\Qt\\5.15.2\\mingw81_64\\qtbase\\src\\plugins\\sqldrivers\\mysql\\mysql</code> 产生动态链接库，其中 <code>C:\\Qt\\5.15.2\\mingw81_64\\qtbase</code> 为新建的目录。</p><p>注：如果选择 <code>MSVC 2019 64</code> 构建的话，则会 <code>C:\\Qt\\5.15.2\\msvc2019_64\\qtbase\\src\\plugins\\sqldrivers\\mysql\\mysql</code> 产生动态连接库，其中 <code>C:\\Qt\\5.15.2\\msvc2019_64\\qtbase</code> 为新建的目录。</p><p>将产生的 <code>qsqlmysql.dll</code> 和 <code>qsqlmysql.dll.debug</code> 复制到 <code>C:\\Qt\\5.15.2\\mingw81_64\\plugins\\sqldrivers</code> 目录中。</p><p>注：如果选择 <code>MSVC 2019 64</code>，则将 <code>qsqlmysqld.pdb</code>、<code>qsqlmysql.dll</code>、<code>qsqlmysql.pdb</code> 和 <code>qsqlmysqld.dll</code> 复制到 <code>C:\\Qt\\5.15.2\\msvc2019_64\\plugins\\sqldrivers</code>。</p><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h2><p>如果 MySQL Server 以安装形式安装的，则不用 CMakeLists.txt 中添加 libmysql.lib 路径。</p><div class="language-cmake vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cmake</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">find_package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Qt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${QT_VERSION_MAJOR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REQUIRED COMPONENTS Sql)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(your_program </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Qt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${QT_VERSION_MAJOR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::Sql)</span></span></code></pre></div><h2 id="其他问题" tabindex="-1">其他问题 <a class="header-anchor" href="#其他问题" aria-label="Permalink to &quot;其他问题&quot;">​</a></h2><p>最后发现，老是爆出如下问题</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>QSqlDatabase: QMYSQL driver not loaded</span></span>
<span class="line"><span>QSqlDatabase: available drivers: QSQLITE QMARIADB QMYSQL QMYSQL3 QODBC QODBC3 QPSQL QPSQL7</span></span>
<span class="line"><span>QSqlDatabase: an instance of QCoreApplication is required for loading driver plugins</span></span></code></pre></div><p>突然发现有个 github 仓库专门编译好 dll，见 <a href="https://github.com/thecodemonkey86/qt_mysql_driver/releases/tag/qmysql_5.15.2" target="_blank" rel="noreferrer">https://github.com/thecodemonkey86/qt_mysql_driver/releases/tag/qmysql_5.15.2</a></p>`,21)]))}const g=a(l,[["render",i]]);export{h as __pageData,g as default};
